# Forge - Ralph Wiggum Implementation for Droid

A complete Ralph Wiggum autonomous development system using Factory's Droid agent. This implementation provides two parallel development loops (frontend and backend) with a web-based monitoring UI for observing progress in real time.

## Overview

Ralph is an autonomous, iterative development workflow that:
- **Plans** by analyzing specifications and creating implementation plans
- **Builds** by implementing one task at a time with full test coverage
- **Learns** by updating operational guides based on discoveries

### Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│                        Web UI (port 3000)                       │
│  ┌──────────┐  ┌──────────────────┐  ┌──────────────────┐      │
│  │ Artifacts│  │  Frontend Stream │  │  Backend Stream  │      │
│  │  Panel   │  │                  │  │                  │      │
│  └──────────┘  └──────────────────┘  └──────────────────┘      │
└─────────────────────────────────────────────────────────────────┘
        │                   │                    │
        │    WebSocket + File Watching           │
        ▼                                        ▼
┌───────────────┐                      ┌───────────────┐
│  Frontend     │                      │   Backend     │
│  Loop         │                      │   Loop        │
│  (Droid)      │                      │   (Droid)     │
└───────────────┘                      └───────────────┘
        │                                    │
        ▼                                    ▼
   src/frontend/                        src/backend/
```

## Prerequisites

- **Node.js** >= 18.0.0
- **Droid CLI** installed and authenticated
- **Bash** (Git Bash on Windows, or WSL)
- **Git** for version control

### Install Droid CLI

```bash
# macOS/Linux
curl -fsSL https://app.factory.ai/cli | sh

# Windows (PowerShell)
irm https://app.factory.ai/cli | iex
```

Then authenticate:
```bash
droid
# Follow browser prompts to sign in
```

## Project Structure

```
Forge/
├── ralph/                           # Ralph loop infrastructure
│   ├── frontend/
│   │   ├── loop.sh                  # Frontend loop orchestration
│   │   ├── PROMPT_plan.md           # Planning mode instructions
│   │   ├── PROMPT_build.md          # Building mode instructions
│   │   ├── AGENTS.md                # Operational guide (updated by Ralph)
│   │   └── IMPLEMENTATION_PLAN.md   # Task list (generated by Ralph)
│   ├── backend/
│   │   ├── loop.sh                  # Backend loop orchestration
│   │   ├── PROMPT_plan.md           # Planning mode instructions
│   │   ├── PROMPT_build.md          # Building mode instructions
│   │   ├── AGENTS.md                # Operational guide (updated by Ralph)
│   │   └── IMPLEMENTATION_PLAN.md   # Task list (generated by Ralph)
│   ├── web-ui/
│   │   ├── server.ts                # Express + WebSocket server
│   │   ├── public/                  # Static frontend files
│   │   └── state/                   # Loop state files
│   └── logs/                        # Iteration logs
├── specs/                           # Requirement specifications
├── src/
│   ├── frontend/                    # Frontend application code
│   └── backend/                     # Backend application code
└── README.md
```

## Quick Start

### 1. Install Dependencies

```bash
# Install web UI dependencies
cd ralph/web-ui
npm install

# Return to project root
cd ../..
```

### 2. Start the Web UI

```bash
cd ralph/web-ui
npm run dev
```

Open http://localhost:3000 in your browser.

### 3. Write Specifications

Create specification files in the `specs/` directory:

```markdown
# specs/user-authentication.md

## Overview
User authentication system with email/password login.

## Requirements
- Users can register with email and password
- Users can log in and receive a session token
- Passwords must be hashed with bcrypt
- Sessions expire after 24 hours

## Acceptance Criteria
- [ ] POST /api/auth/register creates a new user
- [ ] POST /api/auth/login returns a JWT token
- [ ] Invalid credentials return 401
- [ ] Passwords are never stored in plaintext
```

### 4. Run Planning Mode

Start planning for each loop (in separate terminals):

```bash
# Terminal 1: Frontend planning
cd ralph/frontend
chmod +x loop.sh
./loop.sh plan

# Terminal 2: Backend planning
cd ralph/backend
chmod +x loop.sh
./loop.sh plan
```

The agents will:
1. Analyze all specifications
2. Perform gap analysis against existing code
3. Generate implementation plans with prioritized tasks

### 5. Run Building Mode

Once planning is complete:

```bash
# Terminal 1: Frontend building
cd ralph/frontend
./loop.sh

# Terminal 2: Backend building
cd ralph/backend
./loop.sh
```

The agents will:
1. Pick the highest priority task
2. Search existing code (never assume missing)
3. Implement completely with tests
4. Validate (typecheck, lint, test)
5. Commit and update plans
6. Repeat until all tasks complete

## Usage Guide

### Loop Commands

```bash
# Planning mode (analyze specs, create plan)
./loop.sh plan

# Planning mode with max iterations
./loop.sh plan 5

# Building mode (implement from plan)
./loop.sh

# Building mode with max iterations
./loop.sh 20
```

### Viewing Artifacts

Click any artifact link in the left panel to view:
- **Implementation Plan** - Current task list and status
- **AGENTS.md** - Operational learnings
- **Prompts** - Instructions given to agents

### Monitoring Progress

- **Live Stream** - Real-time view of agent actions
- **Iteration History** - Select past iterations from dropdown
- **Status Badge** - Current loop state (Running, Idle, Error)

## Workflow Philosophy

### Key Principles

1. **Context is Everything**
   - Each iteration starts fresh with clean context
   - Prompts + AGENTS.md loaded every time
   - Plans persist on disk between iterations

2. **One Task Per Iteration**
   - Complete one task fully before moving on
   - Validates with tests before committing
   - Clean git history

3. **Acceptance-Driven Backpressure**
   - Tests derived from spec acceptance criteria
   - All required tests must pass
   - No stubs or placeholders

4. **Let Ralph Ralph**
   - Trust the agent to self-correct
   - Plans are disposable - regenerate if wrong
   - Observe and tune prompts based on failures

### Modes

| Mode | Model | Purpose |
|------|-------|---------|
| Planning (Frontend) | Claude Opus 4.5 | Gap analysis, task prioritization |
| Planning (Backend) | Claude Opus 4.5 | Gap analysis, task prioritization |
| Building (Frontend) | Gemini 3 Pro | Implementation, testing |
| Building (Backend) | GPT-5.2 | Implementation, testing |

## Configuration

### Environment Variables

```bash
# ralph/web-ui
PORT=3000                    # Web UI port
```

### Customizing Models

Edit `loop.sh` to change models:

```bash
# Planning mode
MODEL="claude-opus-4-5-20251101"
REASONING="high"

# Building mode
MODEL="gemini-3-pro-preview"  # or "gpt-5.2" for backend
REASONING="medium"
```

## Troubleshooting

### Loop won't start

1. Ensure Droid CLI is installed: `droid --version`
2. Ensure you're authenticated: `droid` (should show TUI)
3. Check prompt files exist in the loop directory

### Plan getting stale or wrong

Regenerate by running planning mode:
```bash
./loop.sh plan
```

Or delete and regenerate:
```bash
rm IMPLEMENTATION_PLAN.md
./loop.sh plan
```

### Tests failing repeatedly

1. Check AGENTS.md has correct test commands
2. Verify test infrastructure is set up
3. May need to add more backpressure guidance to prompts

## Recovery

### Stop a loop
Press `Ctrl+C` in the terminal running the loop.

### Revert uncommitted changes
```bash
git reset --hard HEAD
```

### Reset to clean state
```bash
git checkout -- src/frontend/
git checkout -- src/backend/
```

## Best Practices

1. **Write detailed specs** with clear acceptance criteria
2. **Start with planning** before building
3. **Watch early iterations** to understand agent behavior
4. **Tune prompts** based on observed failures
5. **Keep AGENTS.md operational** - not a changelog
6. **Commit frequently** - each task = one commit
7. **Use the web UI** to monitor both loops simultaneously

## License

MIT

## Credits

Based on the [Ralph Wiggum methodology](https://ghuntley.com/ralph/) by Geoffrey Huntley.

Implemented using [Factory Droid](https://docs.factory.ai/).
